# 基础代谢率(BMR)计算器 - 实现思考

## 1. 核心需求分析

### 1.1 输入参数
- 性别(gender): 男性/女性
- 年龄(age): 用户年龄
- 身高(height): 用户身高(cm)
- 体重(weight): 用户体重(kg)

### 1.2 输出要求
- 基础代谢率(BMR): 每日维持基本生命活动所需的热量(kcal/天)

### 1.3 基本约束
- 所有输入参数必须为有效值
- 计算结果需要保留整数
- 需要适当的错误处理机制

## 2. 技术挑战

### 2.1 输入验证要点
- 性别必须为有效选项（男/女）
- 年龄必须为正整数且在合理范围内（如：0-120岁）
- 身高必须为正数且在合理范围内（如：30-250cm）
- 体重必须为正数且在合理范围内（如：2-300kg）

### 2.2 计算精度要求
- BMR计算需要使用浮点数进行精确计算
- 最终结果需要四舍五入到整数

### 2.3 错误处理策略
- 对无效输入需要抛出具体的异常
- 异常信息需要清晰指出具体的错误原因
- 需要处理可能的计算过程中的异常（如溢出）

## 3. 可选实现方案

### 3.1 方案A：函数式实现
```python
def calculate_bmr(gender: str, age: float, height: float, weight: float) -> int:
    """单一函数实现BMR计算"""
```
优点：
- 实现简单直接
- 调用方便
- 适合单一功能实现
缺点：
- 扩展性较差
- 难以添加额外功能
- 验证逻辑和计算逻辑混合

### 3.2 方案B：类封装实现
```python
class BMRCalculator:
    """BMR计算器类"""
    def __init__(self):
        pass
    
    def calculate(self, gender: str, age: float, height: float, weight: float) -> int:
        """计算BMR"""
```
优点：
- 更好的封装性
- 便于扩展新功能
- 可以添加更多辅助方法
缺点：
- 相对复杂
- 可能过度设计

### 3.3 方案C：数据类+函数实现
```python
from dataclasses import dataclass

@dataclass
class PersonData:
    gender: str
    age: float
    height: float
    weight: float

def calculate_bmr(person: PersonData) -> int:
    """基于数据类的BMR计算"""
```
优点：
- 数据结构清晰
- 验证和计算分离
- 代码结构清晰
缺点：
- 需要额外的数据类定义
- 使用略微复杂

## 4. BMR计算公式选择

### 4.1 Harris-Benedict公式
最常用的BMR计算公式：

男性：
BMR = 66.5 + (13.75 × 体重kg) + (5.003 × 身高cm) - (6.755 × 年龄)

女性：
BMR = 655.1 + (9.563 × 体重kg) + (1.850 × 身高cm) - (4.676 × 年龄)

优点：
- 使用广泛，被大量研究验证
- 计算相对简单
- 适用于大多数人群

### 4.2 Mifflin-St Jeor公式
更现代的BMR计算公式：

男性：
BMR = (10 × 体重kg) + (6.25 × 身高cm) - (5 × 年龄) + 5

女性：
BMR = (10 × 体重kg) + (6.25 × 身高cm) - (5 × 年龄) - 161

优点：
- 更新的研究支持
- 对现代人群更准确
- 计算同样简单

## 5. 推荐方案

经过与研发团队和领域专家的讨论，我们决定采用：

1. **实现方式**：方案C（数据类+函数实现）
   - 使用数据类可以更好地封装和验证输入数据
   - 通过分离数据结构和计算逻辑，提高代码可维护性
   - 便于后续扩展（如添加更多的计算方法或验证规则）
   - 数据类的类型提示可以提供更好的IDE支持

2. **计算公式**：Harris-Benedict公式
   - 经过专家确认，这个公式在实践中更为可靠
   - 有大量研究数据支持其准确性
   - 在医疗和健康领域被广泛使用和验证
   - 计算结果更符合亚洲人群的身体特征

## 6. 下一步计划

1. 设计PersonData数据类的具体结构和验证规则
2. 设计calculate_bmr函数的详细接口
3. 规划输入验证和异常处理策略
4. 设计测试用例（包括边界值测试）
5. 实现核心功能
6. 完善错误处理和文档 