---
description: Pythonä»£ç é”™è¯¯å¤„ç†æŒ‡å—
globs: 
alwaysApply: false
---
# é”™è¯¯å¤„ç†æŒ‡å—

## æ ¸å¿ƒåŸåˆ™å®£è¨€

âš¡ï¸ æ ¸å¿ƒé—®é¢˜ï¼šä¸è‰¯çš„é”™è¯¯å¤„ç†ç­–ç•¥å¯¼è‡´ç³»ç»Ÿè„†å¼±ã€éš¾ä»¥è°ƒè¯•ï¼Œå¹¶å¯èƒ½é€ æˆä¸¥é‡çš„ç”Ÿäº§é—®é¢˜ã€‚

ğŸ’¥ ä¸éµå¾ªçš„åæœï¼š
- æœªå¤„ç†çš„å¼‚å¸¸å¯¼è‡´ç³»ç»Ÿå´©æºƒå’ŒæœåŠ¡ä¸­æ–­
- æ¨¡ç³Šçš„é”™è¯¯ä¿¡æ¯ä½¿è°ƒè¯•å›°éš¾ä¸”å»¶é•¿é—®é¢˜è§£å†³æ—¶é—´
- é”™è¯¯ä¼ æ’­ä¸å—æ§åˆ¶ï¼Œéš¾ä»¥å®šä½æºå¤´å’Œè´£ä»»è¾¹ç•Œ
- ç”¨æˆ·ä½“éªŒå·®ï¼Œæ— æ³•è·å¾—æœ‰æ„ä¹‰çš„åé¦ˆå’Œæ¢å¤è·¯å¾„
- å®‰å…¨éšæ‚£å¢åŠ ï¼Œå¯èƒ½æš´éœ²æ•æ„Ÿä¿¡æ¯æˆ–ç³»ç»Ÿç»†èŠ‚

ğŸ’ éµå¾ªçš„æ”¶ç›Šï¼š
- æé«˜ç³»ç»Ÿå¥å£®æ€§å’Œå¯é æ€§ï¼Œå‡å°‘æ„å¤–å®•æœº
- ç²¾ç¡®çš„é”™è¯¯ä¿¡æ¯ä¾¿äºè°ƒè¯•å’Œç›‘æ§ï¼ŒåŠ é€Ÿé—®é¢˜è§£å†³
- æœ‰å±‚æ¬¡çš„é”™è¯¯å¤„ç†è®©ç³»ç»Ÿä¼˜é›…é™çº§ï¼Œä¿æŒæ ¸å¿ƒåŠŸèƒ½
- ç”¨æˆ·æ”¶åˆ°å‹å¥½ä¸”æœ‰æ„ä¹‰çš„é”™è¯¯åé¦ˆï¼Œæå‡ä½“éªŒ
- é”™è¯¯æ¨¡å¼å¯è¢«åˆ†æï¼Œå¸®åŠ©è¯†åˆ«ç³»ç»Ÿæ”¹è¿›ç‚¹

âš–ï¸ éœ€è¦æƒè¡¡ï¼š
- æƒè¡¡ç‚¹1ï¼šé”™è¯¯å¤„ç†çš„ç²’åº¦ VS ä»£ç ç®€æ´æ€§
- æƒè¡¡ç‚¹2ï¼šé”™è¯¯ä¿¡æ¯è¯¦å°½ VS å®‰å…¨æ€§è€ƒè™‘
- æƒè¡¡ç‚¹3ï¼šå¼‚å¸¸æ¢å¤ VS åŠæ—¶å¤±è´¥
- æƒè¡¡ç‚¹4ï¼šé›†ä¸­å¤„ç† VS åˆ†æ•£å¤„ç†
- æƒè¡¡ç‚¹5ï¼šé”™è¯¯ä¼ æ’­è·ç¦» VS å¤„ç†èŒè´£

## å…³é”®å®è·µ

### å®è·µä¸€ï¼šå¼‚å¸¸å±‚æ¬¡ç»“æ„

ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·åšï¼š
è®¾è®¡è‰¯å¥½çš„å¼‚å¸¸å±‚æ¬¡ç»“æ„ä½¿é”™è¯¯ç±»å‹æ¸…æ™°ã€å¤„ç†ç²¾ç¡®ï¼Œå¹¶èƒ½åœ¨é€‚å½“çº§åˆ«æ•è·å’Œå¤„ç†å¼‚å¸¸ã€‚

âŒ å¸¸è§é”™è¯¯ï¼š
```python
# ä½¿ç”¨æ³›æ³›çš„å†…ç½®å¼‚å¸¸
def process_config(config_path):
    try:
        with open(config_path) as f:
            config = json.load(f)
        # å¤„ç†é…ç½®...
    except Exception as e:  # è¿‡äºå®½æ³›çš„æ•è·
        print(f"Error: {e}")  # ä¸æ¸…æ™°çš„é”™è¯¯æ¶ˆæ¯
        return None  # ä¸¢å¤±é”™è¯¯ä¸Šä¸‹æ–‡
```

âœ… æ­£ç¡®åšæ³•ï¼š
```python
# è‡ªå®šä¹‰å¼‚å¸¸å±‚æ¬¡
class ConfigError(Exception):
    """é…ç½®ç›¸å…³é”™è¯¯çš„åŸºç±»"""
    pass

class ConfigFileNotFoundError(ConfigError):
    """é…ç½®æ–‡ä»¶ä¸å­˜åœ¨"""
    pass

class ConfigParseError(ConfigError):
    """é…ç½®è§£æé”™è¯¯"""
    pass

class ConfigValidationError(ConfigError):
    """é…ç½®éªŒè¯å¤±è´¥"""
    def __init__(self, message, errors=None):
        super().__init__(message)
        self.errors = errors or []  # å­˜å‚¨è¯¦ç»†çš„éªŒè¯é”™è¯¯åˆ—è¡¨

def process_config(config_path):
    try:
        try:
            with open(config_path) as f:
                try:
                    config = json.load(f)
                except json.JSONDecodeError as e:
                    raise ConfigParseError(f"Invalid JSON format in {config_path}: {e}") from e
                
                # éªŒè¯é…ç½®
                errors = validate_config(config)
                if errors:
                    raise ConfigValidationError("Config validation failed", errors)
        except FileNotFoundError as e:
            raise ConfigFileNotFoundError(f"Config file not found: {config_path}") from e
        
        # å¤„ç†é…ç½®...
        return config
    except ConfigFileNotFoundError as e:
        logger.error(f"Missing configuration file: {e}")
        return create_default_config()  # åˆ›å»ºé»˜è®¤é…ç½®
    except ConfigParseError as e:
        logger.error(f"Cannot parse configuration: {e}")
        return create_default_config()  # åˆ›å»ºé»˜è®¤é…ç½®
    except ConfigValidationError as e:
        logger.error(f"Invalid configuration: {e}")
        for error in e.errors:
            logger.warning(f"  - {error}")
        return create_default_config()  # åˆ›å»ºé»˜è®¤é…ç½®
    except ConfigError as e:
        # å¤„ç†å…¶ä»–é…ç½®é”™è¯¯
        logger.error(f"Configuration error: {e}")
        return create_default_config()  # åˆ›å»ºé»˜è®¤é…ç½®
```

ğŸ”„ é‡æ„è·¯å¾„ï¼š
1. è®¾è®¡å¼‚å¸¸ç±»å±‚æ¬¡ç»“æ„ï¼Œåæ˜ ä¸šåŠ¡é¢†åŸŸæ¦‚å¿µ
2. å°†æ³›åŒ–å¼‚å¸¸å¤„ç†åˆ†è§£ä¸ºå…·ä½“ç±»å‹å¤„ç†
3. ä½¿ç”¨å¼‚å¸¸é“¾ï¼ˆfromè¯­å¥ï¼‰ä¿ç•™åŸå§‹ä¸Šä¸‹æ–‡
4. æ·»åŠ æœ‰æ„ä¹‰çš„é”™è¯¯æ¶ˆæ¯å’Œç›¸å…³å…ƒæ•°æ®
5. åˆ†å±‚å¤„ç†ä¸åŒç±»å‹çš„å¼‚å¸¸ï¼Œå®æ–½å·®å¼‚åŒ–æ¢å¤ç­–ç•¥

### å®è·µäºŒï¼šåˆç†çš„é”™è¯¯æ¢å¤ç­–ç•¥

ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·åšï¼š
ä¼˜ç§€çš„é”™è¯¯æ¢å¤ç­–ç•¥ä½¿ç³»ç»Ÿåœ¨å‡ºç°é—®é¢˜æ—¶èƒ½å¤Ÿç»§ç»­è¿è¡Œï¼Œæé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œç”¨æˆ·ä½“éªŒã€‚

âŒ å¸¸è§é”™è¯¯ï¼š
```python
# ä¸æ°å½“çš„é”™è¯¯å¤„ç†
def fetch_data(url):
    try:
        response = requests.get(url, timeout=5)
        return response.json()
    except:  # æ— å·®åˆ«æ•è·æ‰€æœ‰å¼‚å¸¸
        return {}  # é™é»˜å¤±è´¥ï¼Œä¸¢å¤±é”™è¯¯ä¿¡æ¯
```

âœ… æ­£ç¡®åšæ³•ï¼š
```python
class DataFetchError(Exception):
    """æ•°æ®è·å–é”™è¯¯åŸºç±»"""
    pass

class TemporaryDataFetchError(DataFetchError):
    """ä¸´æ—¶æ€§æ•°æ®è·å–é”™è¯¯ï¼Œå¯ä»¥é‡è¯•"""
    pass

class PermanentDataFetchError(DataFetchError):
    """æ°¸ä¹…æ€§æ•°æ®è·å–é”™è¯¯ï¼Œé‡è¯•æ— æ•ˆ"""
    pass

def fetch_data(url, retries=3, cache_key=None):
    """ä»URLè·å–æ•°æ®ï¼Œæ”¯æŒé‡è¯•ã€é”™è¯¯åˆ†ç±»å’Œç¼“å­˜
    
    Args:
        url: è¯·æ±‚çš„URL
        retries: é‡è¯•æ¬¡æ•°
        cache_key: ç¼“å­˜é”®ï¼Œå¦‚æœæä¾›ä¸”æœ‰ç¼“å­˜ï¼Œå°†ä¼˜å…ˆä½¿ç”¨ç¼“å­˜
        
    Returns:
        è§£æçš„JSONæ•°æ®
        
    Raises:
        PermanentDataFetchError: å½“æ— æ³•è·å–æ•°æ®ä¸”é”™è¯¯ä¸å¯æ¢å¤
    """
    # ä¼˜å…ˆä½¿ç”¨ç¼“å­˜
    if cache_key and cache.exists(cache_key):
        logger.info(f"Using cached data for {url} with key {cache_key}")
        try:
            return cache.get(cache_key)
        except Exception as e:
            logger.warning(f"Cache retrieval failed for key {cache_key}: {e}")
            # ç¼“å­˜å¤±è´¥ä¸é˜»æ­¢ç»§ç»­å°è¯•ç½‘ç»œè¯·æ±‚
    
    # æŒ‡æ•°é€€é¿å‚æ•°
    backoff_factor = 0.5
    
    for attempt in range(retries):
        wait_time = backoff_factor * (2 ** attempt)
        try:
            logger.info(f"Fetching data from {url}, attempt {attempt+1}/{retries}")
            start_time = time.time()
            response = requests.get(url, timeout=5)
            elapsed = time.time() - start_time
            
            # è®°å½•æ€§èƒ½æŒ‡æ ‡
            logger.debug(f"Request to {url} took {elapsed:.2f}s")
            
            # å¤„ç†HTTPé”™è¯¯
            response.raise_for_status()
            
            # å¤„ç†å“åº”
            data = response.json()
            
            # æˆåŠŸè·å–æ•°æ®ï¼Œå­˜å…¥ç¼“å­˜
            if cache_key:
                cache.set(cache_key, data, ttl=3600)  # 1å°æ—¶è¿‡æœŸ
                
            return data
            
        except requests.exceptions.Timeout as e:
            logger.warning(f"Timeout on {url}, attempt {attempt+1}/{retries}: {e}")
            # è¶…æ—¶é€šå¸¸å¯ä»¥é‡è¯•
            if attempt == retries - 1:
                raise TemporaryDataFetchError(f"Request timed out after {retries} attempts: {e}") from e
                
        except requests.exceptions.ConnectionError as e:
            logger.warning(f"Connection error on {url}, attempt {attempt+1}/{retries}: {e}")
            # è¿æ¥é”™è¯¯å¯èƒ½æ˜¯ä¸´æ—¶çš„
            if attempt == retries - 1:
                raise TemporaryDataFetchError(f"Connection failed after {retries} attempts: {e}") from e
                
        except requests.exceptions.HTTPError as e:
            status_code = e.response.status_code if e.response else "unknown"
            logger.error(f"HTTP error {status_code} on {url}: {e}")
            
            # æ ¹æ®HTTPçŠ¶æ€ç åˆ¤æ–­æ˜¯å¦å€¼å¾—é‡è¯•
            if 500 <= status_code < 600:  # æœåŠ¡å™¨é”™è¯¯
                if attempt == retries - 1:
                    raise TemporaryDataFetchError(f"Server error {status_code} after {retries} attempts") from e
            else:  # å®¢æˆ·ç«¯é”™è¯¯ï¼Œä¸€èˆ¬ä¸é‡è¯•
                raise PermanentDataFetchError(f"Client error {status_code}: {e}") from e
                
        except requests.exceptions.RequestException as e:
            # å…¶ä»–è¯·æ±‚å¼‚å¸¸
            logger.error(f"Request failed on {url}: {e}")
            raise PermanentDataFetchError(f"Request failed: {e}") from e
            
        except ValueError as e:
            # JSONè§£æé”™è¯¯
            logger.error(f"Failed to parse JSON from {url}: {e}")
            raise PermanentDataFetchError(f"Invalid response format: {e}") from e
            
        # ç­‰å¾…åé‡è¯•
        if attempt < retries - 1:
            logger.info(f"Waiting {wait_time:.2f}s before next attempt")
            time.sleep(wait_time)
    
    # æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¾ªç¯å†…ä¼šè¿”å›ç»“æœæˆ–æŠ›å‡ºå¼‚å¸¸
    # è¿™é‡Œæ˜¯é˜²å¾¡æ€§ä»£ç 
    raise TemporaryDataFetchError(f"Failed to fetch data after {retries} attempts with no specific error")
```

ğŸ”„ é‡æ„è·¯å¾„ï¼š
1. ç¡®å®šå…³é”®æ“ä½œå¯èƒ½çš„é”™è¯¯ç±»å‹å’Œæ¢å¤ç­–ç•¥
2. è®¾è®¡åˆé€‚çš„é‡è¯•ã€ç¼“å­˜å’Œå›é€€ç­–ç•¥
3. åŒºåˆ†ä¸´æ—¶æ€§é”™è¯¯å’Œæ°¸ä¹…æ€§é”™è¯¯
4. è®°å½•è¯¦ç»†é”™è¯¯ä¿¡æ¯ä»¥ä¾¿è°ƒè¯•å’Œç›‘æ§
5. å®ç°ä¼˜é›…é™çº§æœºåˆ¶ï¼Œå¦‚ä½¿ç”¨ç¼“å­˜æ•°æ®

### å®è·µä¸‰ï¼šå…¨é¢çš„æ—¥å¿—è®°å½•

ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·åšï¼š
è‰¯å¥½çš„æ—¥å¿—è®°å½•åœ¨é”™è¯¯å‘ç”Ÿæ—¶æä¾›å…³é”®ä¸Šä¸‹æ–‡ï¼Œæœ‰åŠ©äºå¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜ã€‚

âŒ å¸¸è§é”™è¯¯ï¼š
```python
# ä¸å®Œæ•´çš„æ—¥å¿—è®°å½•
def update_user(user_id, data):
    try:
        user = db.users.find_one({"id": user_id})
        if not user:
            return False
        db.users.update_one({"id": user_id}, {"$set": data})
        return True
    except Exception as e:
        print(f"Error: {e}")  # ç®€å•æ‰“å°é”™è¯¯
        return False
```

âœ… æ­£ç¡®åšæ³•ï¼š
```python
import logging
import traceback
import uuid
import time
import json
from contextlib import contextmanager

logger = logging.getLogger(__name__)

@contextmanager
def operation_logger(operation_name, **context):
    """è®°å½•æ“ä½œæ—¥å¿—çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨
    
    Args:
        operation_name: æ“ä½œåç§°
        **context: æ“ä½œä¸Šä¸‹æ–‡ä¿¡æ¯
    """
    operation_id = str(uuid.uuid4())
    start_time = time.time()
    
    # è„±æ•ä¸Šä¸‹æ–‡ï¼Œç§»é™¤æ•æ„Ÿä¿¡æ¯
    safe_context = sanitize_context(context)
    
    logger.info(f"Starting operation {operation_name} [id={operation_id}] with context: {json.dumps(safe_context)}")
    
    try:
        yield operation_id
        elapsed = time.time() - start_time
        logger.info(f"Operation {operation_name} [id={operation_id}] completed successfully in {elapsed:.2f}s")
    except Exception as e:
        elapsed = time.time() - start_time
        logger.error(
            f"Operation {operation_name} [id={operation_id}] failed after {elapsed:.2f}s: {e}",
            exc_info=True  # åŒ…å«å †æ ˆä¿¡æ¯
        )
        # é‡æ–°æŠ›å‡ºå¼‚å¸¸ä»¥ä¾¿è°ƒç”¨è€…å¤„ç†
        raise

class DatabaseError(Exception):
    """æ•°æ®åº“æ“ä½œé”™è¯¯"""
    pass

class UserNotFoundError(DatabaseError):
    """ç”¨æˆ·æœªæ‰¾åˆ°é”™è¯¯"""
    pass

class UserUpdateError(DatabaseError):
    """ç”¨æˆ·æ›´æ–°é”™è¯¯"""
    pass

def update_user(user_id, data, request_id=None):
    """æ›´æ–°ç”¨æˆ·ä¿¡æ¯
    
    Args:
        user_id: ç”¨æˆ·ID
        data: è¦æ›´æ–°çš„æ•°æ®
        request_id: è¯·æ±‚IDï¼Œç”¨äºè·Ÿè¸ª
        
    Returns:
        dict: æ›´æ–°åçš„ç”¨æˆ·æ•°æ®
        
    Raises:
        UserNotFoundError: æŒ‡å®šç”¨æˆ·ä¸å­˜åœ¨
        UserUpdateError: æ›´æ–°æ“ä½œå¤±è´¥
        DatabaseError: å…¶ä»–æ•°æ®åº“æ“ä½œå¤±è´¥
    """
    context = {
        "user_id": user_id,
        "update_fields": list(data.keys()),  # åªè®°å½•å­—æ®µåï¼Œä¸è®°å½•å€¼
        "request_id": request_id,
    }
    
    with operation_logger("update_user", **context) as operation_id:
        try:
            # å…ˆæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
            user = db.users.find_one({"id": user_id})
            if not user:
                logger.warning(f"User {user_id} not found [operation={operation_id}]")
                raise UserNotFoundError(f"User with ID {user_id} does not exist")
            
            # éªŒè¯æ›´æ–°æ•°æ®
            validation_errors = validate_user_data(data)
            if validation_errors:
                error_msg = f"Invalid user data: {', '.join(validation_errors)}"
                logger.warning(f"{error_msg} [operation={operation_id}]")
                raise UserUpdateError(error_msg)
            
            # æ‰§è¡Œæ›´æ–°æ“ä½œ
            start_time = time.time()
            result = db.users.update_one(
                {"id": user_id}, 
                {"$set": data}
            )
            elapsed_db = time.time() - start_time
            
            # æ£€æŸ¥æ›´æ–°ç»“æœ
            if result.matched_count == 0:
                logger.warning(f"User {user_id} not found during update [operation={operation_id}]")
                raise UserNotFoundError(f"User with ID {user_id} does not exist")
                
            if result.modified_count == 0:
                logger.info(f"No changes made to user {user_id} [operation={operation_id}]")
            else:
                logger.info(f"Successfully updated user {user_id} [operation={operation_id}] in {elapsed_db:.2f}s")
            
            # è·å–æ›´æ–°åçš„ç”¨æˆ·æ•°æ®
            updated_user = db.users.find_one({"id": user_id})
            return updated_user
            
        except (UserNotFoundError, UserUpdateError):
            # å·²è®°å½•åœ¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¸­ï¼Œç›´æ¥é‡æ–°æŠ›å‡º
            raise
        except Exception as e:
            # è®°å½•è¯¦ç»†é”™è¯¯ä¿¡æ¯
            logger.error(
                f"Unexpected error updating user {user_id} [operation={operation_id}]: {e}",
                exc_info=True
            )
            # è½¬æ¢ä¸ºè‡ªå®šä¹‰å¼‚å¸¸
            raise DatabaseError(f"Database operation failed: {e}") from e
```

ğŸ”„ é‡æ„è·¯å¾„ï¼š
1. è®¾è®¡ç»“æ„åŒ–çš„æ—¥å¿—æ ¼å¼ï¼ŒåŒ…å«æ“ä½œIDå’Œä¸Šä¸‹æ–‡
2. ä½¿ç”¨ä¸“ä¸šçš„æ—¥å¿—åº“å’Œçµæ´»çš„æ—¥å¿—çº§åˆ«
3. å®ç°ä¸Šä¸‹æ–‡ç®¡ç†å™¨ç®€åŒ–æ“ä½œå’Œé”™è¯¯æ—¥å¿—
4. ç¡®ä¿è®°å½•æ•æ„Ÿä¿¡æ¯å‰è¿›è¡Œè„±æ•å¤„ç†
5. åŒ…å«æ€§èƒ½æŒ‡æ ‡ä»¥ä¾¿åˆ†æç³»ç»Ÿç“¶é¢ˆ

### å®è·µå››ï¼šé”™è¯¯è¾¹ç•Œå’Œç¾éš¾æ¢å¤

ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·åšï¼š
æ˜ç¡®çš„é”™è¯¯è¾¹ç•Œå’Œç¾éš¾æ¢å¤æœºåˆ¶ä½¿ç³»ç»Ÿèƒ½å¤Ÿéš”ç¦»æ•…éšœå¹¶ä»ä¸¥é‡é”™è¯¯ä¸­æ¢å¤ï¼Œæé«˜æ•´ä½“å¯é æ€§ã€‚

âŒ å¸¸è§é”™è¯¯ï¼š
```javascript
// æ²¡æœ‰é”™è¯¯è¾¹ç•Œçš„å‰ç«¯ç»„ä»¶
function UserDashboard() {
  const [userData, setUserData] = useState(null);
  
  useEffect(() => {
    fetchUserData()
      .then(data => setUserData(data))
      .catch(error => console.error("Failed to load user data:", error));
  }, []);
  
  // å¦‚æœæ•°æ®åŠ è½½å¤±è´¥ï¼Œå°†å¯¼è‡´æ•´ä¸ªåº”ç”¨å´©æºƒ
  return (
    <div>
      <h1>Welcome, {userData.name}</h1>
      <div>Email: {userData.email}</div>
    </div>
  );
}
```

âœ… æ­£ç¡®åšæ³•ï¼š
```javascript
// é”™è¯¯è¾¹ç•Œç»„ä»¶
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false, error: null, errorInfo: null };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true };
  }

  componentDidCatch(error, errorInfo) {
    // è®°å½•é”™è¯¯åˆ°ç›‘æ§æœåŠ¡
    logErrorToService(error, errorInfo);
    this.setState({ error, errorInfo });
  }

  render() {
    if (this.state.hasError) {
      return this.props.fallback || (
        <div className="error-container">
          <h2>Something went wrong.</h2>
          <button onClick={() => this.setState({ hasError: false })}>
            Try again
          </button>
        </div>
      );
    }
    return this.props.children;
  }
}

// ä½¿ç”¨é”™è¯¯è¾¹ç•Œçš„ç»„ä»¶
function UserDashboard() {
  const [userData, setUserData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  
  useEffect(() => {
    let isMounted = true;
    
    async function loadData() {
      try {
        setLoading(true);
        setError(null);
        
        // æ·»åŠ è¶…æ—¶ä¿æŠ¤
        const timeoutPromise = new Promise((_, reject) => 
          setTimeout(() => reject(new Error("Request timed out")), 5000)
        );
        
        // ç«äº‰æ¡ä»¶ï¼šæ•°æ®åŠ è½½å’Œè¶…æ—¶
        const data = await Promise.race([fetchUserData(), timeoutPromise]);
        
        // æ£€æŸ¥ç»„ä»¶æ˜¯å¦ä»ç„¶æŒ‚è½½
        if (isMounted) {
          setUserData(data);
          setLoading(false);
        }
      } catch (err) {
        console.error("Failed to load user data:", err);
        // æ£€æŸ¥ç»„ä»¶æ˜¯å¦ä»ç„¶æŒ‚è½½
        if (isMounted) {
          setError(err.message || "Failed to load user data");
          setLoading(false);
        }
        
        // ä¸ŠæŠ¥é”™è¯¯
        reportError("user_data_loading_failed", err);
      }
    }
    
    loadData();
    
    return () => {
      isMounted = false;
    };
  }, []);
  
  if (loading) {
    return <LoadingSpinner />;
  }
  
  if (error) {
    return (
      <div className="error-state">
        <p>Error: {error}</p>
        <button onClick={() => loadData()}>Retry</button>
      </div>
    );
  }
  
  if (!userData) {
    return <EmptyState message="No user data available" />;
  }
  
  return (
    <ErrorBoundary fallback={<UserDashboardErrorState />}>
      <div>
        <h1>Welcome, {userData.name}</h1>
        <div>Email: {userData.email}</div>
        
        <ErrorBoundary fallback={<p>Unable to load user statistics</p>}>
          <UserStatistics userId={userData.id} />
        </ErrorBoundary>
        
        <ErrorBoundary fallback={<p>Unable to load recent activity</p>}>
          <RecentActivity userId={userData.id} />
        </ErrorBoundary>
      </div>
    </ErrorBoundary>
  );
}
```

ğŸ”„ é‡æ„è·¯å¾„ï¼š
1. è¯†åˆ«ç³»ç»Ÿä¸­çš„å…³é”®ç»„ä»¶å’Œé”™è¯¯è¾¹ç•Œ
2. ä¸ºæ¯ä¸ªè¾¹ç•Œå®ç°ä¸“é—¨çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶
3. ä½¿ç”¨è¶…æ—¶å’Œæ–­è·¯å™¨ä¿æŠ¤ç³»ç»Ÿèµ„æº
4. æä¾›æœ‰æ„ä¹‰çš„é”™è¯¯UIå’Œæ¢å¤é€‰é¡¹
5. ç¡®ä¿é”™è¯¯çŠ¶æ€ä¸ä¼šå¯¼è‡´çº§è”æ•…éšœ

## å†³ç­–æŒ‡å¯¼

ğŸŒ² å†³ç­–æ ‘ï¼š
1. å¼‚å¸¸å¤„ç†ç­–ç•¥é€‰æ‹©
   - æ˜¯å¦ä¸ºé¢„æœŸçš„é”™è¯¯æƒ…å†µï¼Ÿ
     - æ˜¯ -> ä½¿ç”¨å¼‚å¸¸ä½œä¸ºæ§åˆ¶æµçš„ä¸€éƒ¨åˆ†
     - å¦ -> æ•è·å¼‚å¸¸ï¼Œè®°å½•å¹¶å¯èƒ½é‡æ–°æŠ›å‡º
   
   - é”™è¯¯æ˜¯å¦å¯æ¢å¤ï¼Ÿ
     - æ˜¯ -> å®ç°æ¢å¤ç­–ç•¥ï¼ˆé‡è¯•ã€é™çº§ç­‰ï¼‰
     - å¦ -> æ¸…æ™°è®°å½•ï¼Œå‘ä¸Šä¼ æ’­

2. å¼‚å¸¸ç²’åº¦é€‰æ‹©
   - æ˜¯åŸºç¡€è®¾æ–½/åº“ä»£ç ï¼Ÿ
     - æ˜¯ -> è®¾è®¡è¯¦ç»†çš„å¼‚å¸¸å±‚æ¬¡ç»“æ„
     - å¦ -> å¤ç”¨ç°æœ‰å¼‚å¸¸ï¼Œæ·»åŠ æ˜ç¡®ä¸Šä¸‹æ–‡
   
   - æ˜¯å¦éœ€è¦å¤–éƒ¨ä»£ç ç‰¹åˆ«å¤„ç†ï¼Ÿ
     - æ˜¯ -> åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸ç±»å‹
     - å¦ -> ä½¿ç”¨æ ‡å‡†å¼‚å¸¸ç±»å‹

3. æ—¥å¿—çº§åˆ«é€‰æ‹©
   - æ„å¤–é”™è¯¯ -> ERRORçº§åˆ«
   - å¯é¢„è§ä½†å¼‚å¸¸çš„æƒ…å†µ -> WARNINGçº§åˆ«
   - é‡è¦æ“ä½œçš„ç»“æœ -> INFOçº§åˆ«
   - è°ƒè¯•ä¿¡æ¯ -> DEBUGçº§åˆ«

4. é”™è¯¯æ¢å¤ç­–ç•¥é€‰æ‹©
   - ä¸´æ—¶æ€§é”™è¯¯ï¼ˆç½‘ç»œã€å¹¶å‘ç­‰ï¼‰-> å®ç°é‡è¯•ç­–ç•¥
   - éƒ¨åˆ†æ•°æ®é”™è¯¯ -> è·³è¿‡é”™è¯¯é¡¹ï¼Œå¤„ç†æœ‰æ•ˆé¡¹
   - å…³é”®ç»„ä»¶å¤±è´¥ -> ä½¿ç”¨å¤‡ç”¨å®ç°æˆ–é™çº§æœåŠ¡
   - ä¸å¯æ¢å¤é”™è¯¯ -> æ¸…æ™°æŠ¥å‘Šå¹¶ç»ˆæ­¢æ“ä½œ

ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”ï¼š
| ç­–ç•¥ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‚ç”¨åœºæ™¯ |
|-----|-----|-----|---------|
| ç²¾ç¡®å¼‚å¸¸æ•è· | å¤„ç†ç²¾ç¡®ï¼Œä¸æ©ç›–å…¶ä»–é—®é¢˜ | éœ€è¦æ›´å¤šä»£ç  | å…³é”®ä¸šåŠ¡é€»è¾‘ |
| é€šç”¨å¼‚å¸¸æ•è· | ä»£ç ç®€æ´ | å¯èƒ½æ©ç›–æ½œåœ¨é—®é¢˜ | å¤–éƒ¨APIè°ƒç”¨è¾¹ç•Œ |
| é‡è¯•ç­–ç•¥ | æé«˜ç³»ç»Ÿç¨³å®šæ€§ | å¯èƒ½å»¶è¿Ÿå¤±è´¥ | ç½‘ç»œè¯·æ±‚ã€IOæ“ä½œ |
| é”™è¯¯è¾¹ç•Œ | éš”ç¦»æ•…éšœï¼Œé˜²æ­¢çº§è” | å¢åŠ ä»£ç å¤æ‚åº¦ | å‰ç«¯ç»„ä»¶ã€å¾®æœåŠ¡ |
| å‘ä¸Šä¼ æ’­ | ä¿ç•™å®Œæ•´é”™è¯¯ä¸Šä¸‹æ–‡ | å¯èƒ½å¯¼è‡´ç¨‹åºç»ˆæ­¢ | ä¸å¯æ¢å¤çš„é”™è¯¯ |
| ä¼˜é›…é™çº§ | ä¿æŒæ ¸å¿ƒåŠŸèƒ½å¯ç”¨ | åŠŸèƒ½å—é™ | åˆ†å¸ƒå¼ç³»ç»Ÿ |

## Checklist

#### å¼‚å¸¸è®¾è®¡é˜¶æ®µ
- [ ] æ˜¯å¦è®¾è®¡äº†æ¸…æ™°çš„å¼‚å¸¸å±‚æ¬¡ç»“æ„
      åˆ¤æ–­æ ‡å‡†ï¼šæœ‰é’ˆå¯¹ä¸åŒé”™è¯¯ç±»å‹çš„è‡ªå®šä¹‰å¼‚å¸¸ç±»
      å¿«é€Ÿä¿®å¤ï¼šè®¾è®¡å¹¶å®ç°è‡ªå®šä¹‰å¼‚å¸¸ç±»

- [ ] å¼‚å¸¸ç±»åç§°æ˜¯å¦æ˜ç¡®è¡¨è¾¾é”™è¯¯æ€§è´¨
      åˆ¤æ–­æ ‡å‡†ï¼šåç§°æ˜ç¡®è¡¨ç¤ºé”™è¯¯ç±»å‹å’Œä¸Šä¸‹æ–‡
      å¿«é€Ÿä¿®å¤ï¼šé‡å‘½åå¼‚å¸¸ç±»ä»¥æ›´å¥½è¡¨è¾¾å«ä¹‰

- [ ] æ˜¯å¦ä¸ºå¼‚å¸¸æä¾›äº†æœ‰æ„ä¹‰çš„é”™è¯¯æ¶ˆæ¯
      åˆ¤æ–­æ ‡å‡†ï¼šé”™è¯¯æ¶ˆæ¯åŒ…å«é—®é¢˜ç»†èŠ‚å’Œå¯èƒ½çš„è§£å†³æ–¹æ¡ˆ
      å¿«é€Ÿä¿®å¤ï¼šå¢å¼ºé”™è¯¯æ¶ˆæ¯çš„å†…å®¹å’Œæ ¼å¼

- [ ] å¼‚å¸¸æ˜¯å¦åŒ…å«è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ä¿¡æ¯
      åˆ¤æ–­æ ‡å‡†ï¼šå¼‚å¸¸å¯¹è±¡æºå¸¦è¯Šæ–­æ‰€éœ€çš„å…³é”®æ•°æ®
      å¿«é€Ÿä¿®å¤ï¼šæ‰©å±•å¼‚å¸¸ç±»å¢åŠ ç›¸å…³å±æ€§

#### å¼‚å¸¸å¤„ç†é˜¶æ®µ
- [ ] æ˜¯å¦é¿å…äº†ç©ºçš„exceptå—
      åˆ¤æ–­æ ‡å‡†ï¼šæ¯ä¸ªexceptå—éƒ½æœ‰å®è´¨æ€§å¤„ç†æˆ–æ˜ç¡®çš„passç†ç”±
      å¿«é€Ÿä¿®å¤ï¼šæ·»åŠ é€‚å½“çš„æ—¥å¿—è®°å½•æˆ–é”™è¯¯å¤„ç†

- [ ] æ˜¯å¦é¿å…äº†è¿‡äºå®½æ³›çš„å¼‚å¸¸æ•è·
      åˆ¤æ–­æ ‡å‡†ï¼šexceptè¯­å¥æ•è·ç‰¹å®šç±»å‹å¼‚å¸¸ï¼Œè€ŒéException
      å¿«é€Ÿä¿®å¤ï¼šå°†é€šç”¨å¼‚å¸¸å¤„ç†æ‹†åˆ†ä¸ºç‰¹å®šç±»å‹

- [ ] æ˜¯å¦ä¿ç•™äº†åŸå§‹å¼‚å¸¸ä¸Šä¸‹æ–‡
      åˆ¤æ–­æ ‡å‡†ï¼šä½¿ç”¨fromè¯­å¥é“¾æ¥ç›¸å…³å¼‚å¸¸
      å¿«é€Ÿä¿®å¤ï¼šæ·»åŠ from eåˆ°raiseè¯­å¥

- [ ] é”™è¯¯å¤„ç†ä»£ç æ˜¯å¦æœ¬èº«å¯èƒ½å¼•å‘å¼‚å¸¸
      åˆ¤æ–­æ ‡å‡†ï¼šå¼‚å¸¸å¤„ç†é€»è¾‘åŒ…å«é˜²å¾¡æ€§ç¼–ç¨‹
      å¿«é€Ÿä¿®å¤ï¼šæ·»åŠ åµŒå¥—çš„try-exceptä¿æŠ¤é”™è¯¯å¤„ç†é€»è¾‘

#### æ¢å¤ä¸æ—¥å¿—é˜¶æ®µ
- [ ] æ˜¯å¦å®ç°äº†åˆé€‚çš„é‡è¯•ç­–ç•¥
      åˆ¤æ–­æ ‡å‡†ï¼šå¯¹æš‚æ—¶æ€§é”™è¯¯æœ‰é‡è¯•æœºåˆ¶ï¼ŒåŒ…å«é€€é¿ç­–ç•¥
      å¿«é€Ÿä¿®å¤ï¼šæ·»åŠ å¸¦é€€é¿çš„é‡è¯•å¾ªç¯

- [ ] æ˜¯å¦è®°å½•äº†è¶³å¤Ÿçš„é”™è¯¯ä¸Šä¸‹æ–‡
      åˆ¤æ–­æ ‡å‡†ï¼šæ—¥å¿—åŒ…å«æ“ä½œã€å‚æ•°ã€é”™è¯¯è¯¦æƒ…
      å¿«é€Ÿä¿®å¤ï¼šå¢å¼ºæ—¥å¿—å†…å®¹ï¼Œæ·»åŠ å…³é”®ä¸Šä¸‹æ–‡

- [ ] æ˜¯å¦åœ¨é€‚å½“çš„çº§åˆ«å¤„ç†äº†é”™è¯¯
      åˆ¤æ–­æ ‡å‡†ï¼šé”™è¯¯åœ¨åˆé€‚çš„æŠ½è±¡å±‚å¤„ç†
      å¿«é€Ÿä¿®å¤ï¼šé‡æ„å¼‚å¸¸å¤„ç†åˆ°åˆé€‚çš„å‡½æ•°/ç±»

- [ ] æ˜¯å¦å®ç°äº†ç¾éš¾æ¢å¤æœºåˆ¶
      åˆ¤æ–­æ ‡å‡†ï¼šç³»ç»Ÿèƒ½ä»ä¸¥é‡é”™è¯¯ä¸­æ¢å¤ï¼Œé‡è¦æ•°æ®æœ‰å¤‡ä»½
      å¿«é€Ÿä¿®å¤ï¼šæ·»åŠ åº”æ€¥æ¢å¤è·¯å¾„å’Œèµ„æºå¤‡ä»½

#### ç”¨æˆ·ä½“éªŒä¸å®‰å…¨
- [ ] æ˜¯å¦å‘ç”¨æˆ·æä¾›äº†æœ‰æ„ä¹‰çš„é”™è¯¯æ¶ˆæ¯
      åˆ¤æ–­æ ‡å‡†ï¼šç”¨æˆ·çœ‹åˆ°çš„é”™è¯¯æ˜“äºç†è§£å¹¶æä¾›åç»­æ­¥éª¤
      å¿«é€Ÿä¿®å¤ï¼šæ”¹è¿›ç”¨æˆ·ç•Œé¢é”™è¯¯å‘ˆç°

- [ ] æ˜¯å¦é¿å…äº†åœ¨é”™è¯¯æ¶ˆæ¯ä¸­æ³„éœ²æ•æ„Ÿä¿¡æ¯
      åˆ¤æ–­æ ‡å‡†ï¼šé”™è¯¯æ¶ˆæ¯ç»è¿‡å®‰å…¨å®¡æŸ¥ï¼Œç§»é™¤æ•æ„Ÿæ•°æ®
      å¿«é€Ÿä¿®å¤ï¼šæ·»åŠ é”™è¯¯æ¶ˆæ¯å‡€åŒ–é€»è¾‘

- [ ] æ˜¯å¦æä¾›äº†é”™è¯¯è·Ÿè¸ªæœºåˆ¶
      åˆ¤æ–­æ ‡å‡†ï¼šæ¯ä¸ªé”™è¯¯æœ‰å”¯ä¸€æ ‡è¯†ï¼Œä¾¿äºæ”¯æŒäººå‘˜æŸ¥æ‰¾
      å¿«é€Ÿä¿®å¤ï¼šæ·»åŠ é”™è¯¯IDç”Ÿæˆå’Œå…³è”

- [ ] æ˜¯å¦ä¸ºå…³é”®æ“ä½œæä¾›äº†å›æ»šæœºåˆ¶
      åˆ¤æ–­æ ‡å‡†ï¼šäº‹åŠ¡æ€§æ“ä½œæœ‰å®Œæ•´çš„å›æ»šç­–ç•¥
      å¿«é€Ÿä¿®å¤ï¼šæ·»åŠ äº‹åŠ¡ç®¡ç†æˆ–è¡¥å¿æ€§æ“ä½œ 