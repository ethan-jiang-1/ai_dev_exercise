# Python 项目结构与初始化指南

## 目录组织
- 源码、测试、文档、配置分离
- 使用 README.md 说明功能
- 使用 diagrams/ 存放架构图
- 不过度嵌套目录结构

## 依赖管理
- 使用 venv 创建和管理虚拟环境
- 使用 .env 文件管理配置和密钥
- 在 .gitignore 中排除敏感信息
- 遵循依赖注入原则降低耦合

## 编码规范
- 所有文件必须有类型注解
- 所有函数/类必须有文档字符串(PEP 257)
- 使用 Ruff 保持代码风格
- 保留现有注释

## 模块导入规则

### 环境初始化优先
- 在文件顶部执行 `load_env()`
- 确保项目根目录被正确识别
- 后续所有模块导入都基于此根目录

### 模块独立可运行
- **每个核心模块都应有 `__main__` 测试入口**
- 依赖环境初始化规则
- **总是从项目根目录运行测试**
- **重点**: 每个重要模块单独可调试，便于AI理解实际输入/输出

### 使用绝对路径导入
- 从项目根目录开始的完整导入路径
- 不使用 `.` 或 `..` 的相对导入
- 避免模块位置变动导致的导入错误

## 初始开发规范

### 基础框架搭建
- 先实现最小可用功能集
- 建立清晰的模块边界
- 定义核心接口和数据结构

### 代码质量基线
- 完整的类型注解
- 规范的文档字符串
- 基本的单元测试
- 统一的代码风格

### 配置管理
- 环境变量配置
- 日志系统配置
- 依赖版本管理
- 开发环境设置

## 测试规范

### 测试组织
- 测试目录命名为 `./xxx_tests`
- 按模块名组织测试文件
- 创建必要的 `__init__.py`

### 测试编写
- 使用 pytest 及其插件
- 所有测试需要类型注解和文档
- 使用 fixtures 复用资源
- 使用 parametrize 参数化测试

### 测试入口
- 简单测试放在 `__main__`
- 复杂测试放在 pytest
- 通过 `__main__` 提供快速验证

## 设计模式应用

### 处理器模式
- 业务逻辑层只负责流程编排
- 复杂逻辑下沉到处理器
- 底层处理器独立可测

### 工作空间
- 通过 md_info 共享上下文
- 工作空间隔离保证安全
- 避免直接修改原始文件

### 基础模式
- 工厂模式创建对象
- 策略模式处理算法变体
- 观察者模式处理事件
- 装饰器模式扩展功能 

