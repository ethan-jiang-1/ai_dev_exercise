# 软件工程思维：思考质量决定代码质量 (v3.1 精简版)
> 版本: 3.2 (精简版)

> **通用占位符定义**：
> - `{app_name}`: 应用核心名称 (e.g., `ai_wellness_advisor`)
> - `{module_name}`: 模块名 (e.g., `bmi`)
> - `{FeatureName}`: 特性驼峰名 (e.g., `BMICalculation`)
> - `{feature_name}`: 特性下划线名 (e.g., `bmi_calculation`)
> - `NN`: 两位序号 (e.g., `01`)

> 实战指南，侧重TDD实践，适用于AI+Markdown练习。

## 核心理念：思维留痕，驾驭AI

**代码是思想的副产品。人类价值在于指导、验证和深化思考，而非与AI比拼速度。** 软件失败源于思考不足，AI介入会放大混乱。

### 软件危机的真相：思维跳跃与AI幻觉

跳过思考直接编码（或让AI生成）的后果：系统崩溃、无法维护、永久技术债、团队瘫痪。AI生成的"完美幻觉"加速此过程。

## 三种思维模式的力量：AI时代的融合

本框架重点实践和深化 **测试驱动开发 (TDD) 思维**，作为利用AI构建可靠软件的核心。

### 1. 步步为营：传统软件工程的结构骨架

五个关键阶段：分析 (为AI设目标) -> 规划 (指导AI的蓝图) -> 测试设计 (验证AI的标尺) -> 实现 (编码或指导AI生成并验证) -> 文档 (人与AI的知识库)。**为TDD提供宏观路线图，是驾驭AI协作的基础。**

### 2. 顺序思维：AI协作的导航仪

强调**可追溯、结构化的推理过程**：逐步推理 (分解任务给AI) -> 显式逻辑 (约束AI的知识库) -> 自我检查与AI验证 -> 渐进明晰 (引导AI探索) -> 可追溯性 (AI决策透明可控)。**保障TDD步骤和AI交互清晰可见。**

### 3. 测试驱动思维：AI代码的质量安全网 (核心实践)

**TDD在AI辅助编码时代至关重要：**

1.  **先验证后实现**：先定义"正确" (测试用例)，再让AI或人实现。**精确定义AI任务**。处理复杂单元依赖时，掌握Mocking等单元测试技巧至关重要 (详见 `./tdd_unit_test_design_techniques.md`，**务必阅读**)。
2.  **小步快跑**：分解问题为最小可测单元，适合AI小批量、可控的生成与验证。
3.  **内建柔韧性与安全重构**：AI初始代码常需优化，TDD提供安全重构保障。
4.  **清晰接口**：从使用者视角思考，为AI生成代码提供明确契约。
5.  **即时反馈**：快速验证AI生成代码的正确性。

**无测试，修改AI代码如拆弹；有测试，优化AI代码充满信心。**

TDD优势：高质量约束、无畏重构、活文档、持续进化。

## 证据链：思维痕迹即资产与AI指令

思考痕迹是决策证据、知识库、质量保障、审计线索、**AI指令源**。

### Markdown：思维痕迹与AI知识库的完美载体

轻量、版本控制友好、结构清晰、代码友好、**易于AI解析**。

## 具体步骤：让人与AI的思考都可见

为各阶段创建Markdown文件 (步骤4、5在TDD循环中迭代)：

1. `_user_story_{feature_name}.md` → 问题定义
2. `_s1_think_options_{feature_name}.md` → 解决方案思考
3. `_s2_think_design_{feature_name}.md` → 设计方案 (任务列表)
4. `_s3_think_validation_{feature_name}.md` → 验证策略 (TDD起点)
5. `{feature_name}.{ext}` + `test_{feature_name}.{ext}` → Red-Green-Refactor
6. `_doc_{feature_name}.md` → 文档

(文件均在 `{app_name}/dev_cycles/{module_name}/ExTDD_NN_{FeatureName}/` 或对应 `src`, `tests` 目录)

## 与AI协作：主导而非跟随，教练而非依赖

AI是**思考放大器和执行加速器**。

1. **掌控议程**：你设定方向。
2. **要求思考过程**：拒绝直接方案，要求AI展示步骤。
3. **不断质疑**：挑战AI的关键假设。
4. **保持批判**：用TDD和Code Review严格验证。
5. **引导深入**：提供更明确约束和上下文。

### 有效提示示例 (强调对比)

**错误 (直接要代码):**
`为我写一个解析DICOM文件的Python函数`

**正确 (要求分析思考):**
`我需开发DICOM解析。扮演医疗影像专家，分析：1.主要难点? 2.成熟Python库优缺点? 3.边界情况? 4.大型序列策略? 请勿给代码，重在分析助我选型。`

**错误 (跳过设计):**
`用pydicom库写函数，读DICOM病人名和研究日期，做好错误处理。`

**正确 (要求参与规划):**
`基于分析(s1_*.md)，用pydicom。帮我：1.任务分解(3-5步)。2.核心函数接口设计。3.初步错误处理策略。只需高层思路和签名，暂不需实现。`

## 警惕：AI生成的"完美幻觉"

AI输出的最大危险是"看似合理但实际有缺陷"。无清晰思考链和严格测试，无法区分真伪。**依赖无法理解的"魔法"，终被反噬。**

## 最终准则

**思考即资产，代码只是实现。思维留痕是驾驭AI的基础。** 保存、审视、迭代思考，用它指导和验证AI，远比让AI生产更多代码重要。好的软件工程在于"思考多深"，及如何有效传递并验证于AI协作伙伴。