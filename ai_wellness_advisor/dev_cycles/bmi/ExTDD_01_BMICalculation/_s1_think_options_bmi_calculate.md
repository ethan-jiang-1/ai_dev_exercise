# S1: 思考选项 - BMI 值计算 (ExTDD_01_BMICalculation)

**特性名称**: `bmi_calculate`
**模块名称**: `bmi`
**TDD周期**: ExTDD_01_BMICalculation

## 1. 核心功能点分析

根据用户故事 <mcfile name="_user_story_bmi_calculate.md" path="/Users/bowhead/ai_dev_exercise_tdd/ai_wellness_advisor/dev_cycles/bmi/ExTDD_01_BMICalculation/_user_story_bmi_calculate.md"></mcfile>，核心功能点包括：

1.  接收身高（米）和体重（千克）作为输入。
2.  验证输入的有效性（是否为正数）。
3.  根据公式 `体重 / (身高^2)` 计算BMI。
4.  结果四舍五入到小数点后两位。
5.  返回计算结果或错误提示。

## 2. 技术选型与实现考量

### 2.1. 输入参数处理与验证

*   **选项1: 基本类型校验 + 条件判断**
    *   描述：直接使用 Python 的 `float()` 转换输入，并通过 `if` 语句判断是否大于零。
    *   优点：简单直接，易于理解和实现。
    *   缺点：错误处理逻辑可能分散，如果校验规则复杂，代码会变得冗长。
*   **选项2: 使用 Pydantic 等数据校验库 (初步考虑，可能 overkill)**
    *   描述：定义一个包含身高和体重字段的 Pydantic 模型，利用其内置校验功能。
    *   优点：校验逻辑集中，声明式，错误信息更结构化。
    *   缺点：对于如此简单的功能，引入 Pydantic 可能显得过重，增加依赖。
    *   **决策**：鉴于本练习的简单性，优先考虑选项1。若后续需求扩展，可再考虑引入 Pydantic。

### 2.2. BMI 计算逻辑

*   **选项1: 直接数学运算**
    *   描述：`bmi = weight / (height ** 2)`
    *   优点：清晰明了。
    *   缺点：无明显缺点。
    *   **决策**: 采用此方案。

### 2.3. 结果格式化（四舍五入）

*   **选项1: 使用 `round()` 函数**
    *   描述：`round(bmi, 2)`
    *   优点：Python 内置，简单易用。
    *   缺点：`round()` 对于 .5 的取舍行为可能与某些场景下的严格四舍五入（如银行家舍入法）不同，但对于BMI计算通常可接受。
*   **选项2: 使用 `decimal` 模块**
    *   描述：可以提供更精确的浮点数运算和舍入控制。
    *   优点：精度高，舍入规则可配置。
    *   缺点：对于BMI计算，`decimal` 模块的精度可能非必需，代码略显复杂。
    *   **决策**: 优先使用 `round()`，其行为符合常规预期。

### 2.4. 函数/接口设计

*   **选项1: 单一函数 `calculate_bmi(height: float, weight: float) -> float | str`**
    *   描述：一个函数接收身高和体重，成功则返回计算的BMI值（float），失败则返回错误信息（str）。
    *   优点：简单。
    *   缺点：返回类型不统一，调用方需要判断类型。对于错误处理，可能更倾向于抛出异常。
*   **选项2: 单一函数 `calculate_bmi(height: float, weight: float) -> float` 并抛出自定义异常**
    *   描述：函数接收身高和体重，成功则返回BMI值（float）。输入无效时，抛出自定义异常（如 `InvalidInputError`）。
    *   优点：职责清晰，错误处理机制更规范，调用方通过 `try-except` 捕获。
    *   缺点：需要定义自定义异常类。
    *   **决策**: 选项2 更符合 Pythonic 的错误处理方式，且更利于测试。

### 2.5. 错误处理与提示

*   **选项1: 返回错误字符串 (如选项1的函数设计)**
    *   描述：函数直接返回描述错误的字符串。
*   **选项2: 抛出带错误信息的异常 (如选项2的函数设计)**
    *   描述：定义如 `InvalidHeightError`, `InvalidWeightError` 或统一的 `InvalidInputError`，异常消息中包含具体错误。
    *   优点：更结构化，允许调用者根据异常类型进行不同的处理。
    *   **决策**: 结合函数设计的决策，采用抛出异常的方式。

## 3. 初步技术方案总结

*   **核心函数**: `def calculate_bmi(height: float, weight: float) -> float:`
*   **输入验证**: 在函数内部进行，对身高和体重进行正数校验。若无效，则抛出自定义异常（例如 `ValueError` 或更具体的自定义异常）。
*   **BMI计算**: `weight / (height ** 2)`
*   **结果格式化**: `round(bmi_value, 2)`
*   **错误处理**: 通过抛出和捕获异常来管理无效输入。

## 4. 待讨论与决策点

*   **自定义异常的粒度**：是使用一个通用的 `InvalidInputError`，还是为身高和体重分别定义 `InvalidHeightError` 和 `InvalidWeightError`？
    *   初步倾向：对于此简单场景，`ValueError` 并附带清晰的错误信息可能已足够。如果需要更细致的错误区分，再考虑自定义更具体的异常。
*   **同时输入无效身高和体重时的错误提示优先级** (AC5)：
    *   选项A: 优先提示身高无效。
    *   选项B: 优先提示体重无效。
    *   选项C: 提示两者都无效（可能需要组合错误信息或抛出多个/复合异常，较复杂）。
    *   初步倾向：选项A或B，实现简单。例如，先校验身高，再校验体重。具体在设计阶段明确。

## 5. 下一步

进入 S2 设计阶段，基于以上选项和考量，细化函数签名、错误处理机制、测试用例边界等。