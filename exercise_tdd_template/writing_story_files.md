# 指南：编写有效的 `story_xxx.md` 用户故事文件

本文档旨在指导如何为AI+TDD练习框架编写 `story_xxx.md` 文件。核心目标是回归用户故事的本质：简洁、高层次地描述用户需求，为后续的测试驱动开发（TDD）流程奠定清晰的起点。

## `story_xxx.md` 的核心目的

`story_xxx.md` 文件是每个练习系列的入口点。它不应是详尽的需求规格文档，而更像是一个高级概述，它应该：

1.  **定义练习的整体范围和目标**：围绕哪个核心产品、功能或模块进行练习。
2.  **确立基本结构和命名规范**：如果练习包含多个子特性（如 `ExTDD_01_FeatureA`, `ExTDD_02_FeatureB`），在此处定义它们的 `feature_name` 和预期的目录结构。
3.  **为每个子特性提供一个"粗糙的"原始用户故事**：这是最重要的部分，也是我们近期实践的重点。

## 第一步：规划整个练习系列 (从主题到特性)

在开始为每个具体特性编写"核心用户需求"之前，首要任务是对整个练习系列进行顶层设计和规划。`story_xxx.md` 文件不仅描述单个特性，更重要的是勾勒出整个学习路径或产品功能的演进蓝图。这个规划阶段是能否"一下子写出"一个结构清晰、逻辑连贯的 `story_xxx.md` 的关键所在。

**思考步骤：**

1.  **明确总体学习目标或产品愿景**：
    *   **教学系列视角**：学习者通过完成整个系列练习后，应该掌握哪些核心技能、理解哪些关键概念，或者能够独立完成什么样的任务？
    *   **产品功能开发视角**：这个用户故事系列最终要实现一个什么样的整体产品特性或解决用户的一个什么核心场景？

2.  **分解主题为渐进的特性单元 (Sub-features)**：
    *   将定义好的大的主题或复杂的功能，按照逻辑递进、由简入繁的原则，分解为一系列更小、更易于管理、学习和实现的特性单元。每个单元将构成一个独立的 `ExTDD_XX_FeatureName` 练习。
    *   思考这些单元之间的内在联系、依赖关系和自然的学习/开发顺序。
    *   **示例**：如果我们的主题是"开发一个简单的在线书店商品展示功能"，可以将其分解为：
        *   `ExTDD_01_BookDataModeling` (书籍数据建模与验证)
        *   `ExTDD_02_ListBooks` (展示书籍列表)
        *   `ExTDD_03_ViewBookDetails` (查看单本书籍详情)
        *   `ExTDD_04_SearchBooks` (按关键词搜索书籍)
        *   `ExTDD_05_FilterBooksByCategory` (按分类筛选书籍)

3.  **考虑学习曲线和复杂度递进**：
    *   精心安排特性单元的顺序，确保它们能够形成一个平滑的学习曲线或自然的开发流程。
    *   通常，基础的、核心的功能应该先行，而更高级、更复杂或依赖性较强的特性则放在后面。

4.  **为每个特性单元定义 `feature_name`**：
    *   遵循项目设定的命名规范（例如，小写字母加下划线），为每一个经过分解和确定的特性单元赋予一个清晰、简洁且具有描述性的 `feature_name` (如 `book_data_modeling`, `list_books` 等)。

完成以上规划步骤后，您就有了一个清晰的练习系列蓝图，其中包含了所有子特性及其逻辑顺序。此时，您就可以胸有成竹地开始为每一个特性单元撰写其"核心用户需求"了。

## 第二步：为每个特性编写"核心用户需求"

在上一阶段规划好整个练习系列并确定了所有子特性后，接下来就是为 `story_xxx.md` 中定义的每个具体练习特性 (例如 `ExTDD_01_SomeFeature`) 编写"核心用户需求"部分。我们不再一开始就列出详细的"特定需求"、"技术要点"和"验收标准"，而是提供一个简短、高度凝练的"核心用户需求"。

**关键原则：**

*   **用户视角**：始终从最终用户的角度出发。他们想完成什么？他们有什么痛点？
*   **简洁明了**：用简单、日常的语言（"用人话说"）来描述，避免技术术语和内部行话。
*   **关注"什么"，而非"如何"**：描述用户需要什么功能或想解决什么问题，而不是如何技术实现。
*   **保持高层**：这是一个"粗糙的"故事，细节将在后续的TDD思考阶段（`_s1_think_options_...`, `_s2_think_design_...`, `_s3_think_validation_...`）中逐步明确。

**示例：**

假设我们规划了一个特性 `feature_name: user_profile_display`。

**不推荐的写法 (过于详细，应在后续思考文档中展开)：**

```markdown
#### 特定需求
- 从数据库检索用户ID为X的用户信息。
- 显示用户名、电子邮箱（如果已验证）、注册日期（格式 YYYY-MM-DD）。
- 如果用户有头像URL，则显示头像，否则显示默认占位符。
- API端点为 `/api/v1/users/{id}`。

#### 技术要点
- 使用ORM进行数据库查询。
- 日期格式化库。
- 异步获取头像。

#### 验收标准
- 用户名正确显示。
- 未验证邮箱不显示。
- 头像加载成功或显示占位符。
```

**推荐的写法 (核心用户需求，在 `story_xxx.md` 中)：**

```markdown
#### 核心用户需求 (ExTDD_XX_UserProfileDisplay)
> 作为一名注册用户，我希望能查看我的个人资料页面，这样我可以看到我的基本信息，比如我的名字和注册时间。
```

或者更具体一点，但仍保持用户视角：

```markdown
#### 核心用户需求 (ExTDD_XX_UserProfileDisplay)
> 我想看我的个人资料，方便我确认我的用户名和邮箱是不是对的，也想知道我是啥时候注册的。要是有头像的话，能显示出来就更好了。
```

## 第三步：组装完整的 `story_xxx.md` 文件

完成以上两个步骤后，就可以将规划好的系列结构和为每个特性编写的核心用户需求整合到 `story_xxx.md` 文件中。此时，还需补充以下标准内容：

*   **文档头部说明 (Standard Header)**：这部分是每个 `story_xxx.md` 文件顶部的标准元信息，必须包含：
    *   **工作目录说明**：一个明确的引用块，说明当前文档所在的目录，并强调所有文件引用路径均基于此目录。同时，提供一个具体的例子，展示相对路径如何解析为绝对路径（基于用户的实际工作区路径）。
        *   **示例格式**:
            ```markdown
            > **工作目录说明**：本文档位于 `~/your_workspace_root/current_exercise_directory/` 目录下，所有文件引用路径均基于此目录。例如，`./some_file.md` 实际指向 `/path/to/your_workspace_root/current_exercise_directory/some_file.md`。
            ```
            *(请根据实际的练习系列目录调整路径，例如 `~/ai_dev_exercise/exercise_tdd_pydantic/`)*
    *   **(可选) 实现目录说明**：如果实际代码实现位于主故事文档目录的子目录中，也应在此处说明。
        *   **示例格式**:
            ```markdown
            > **实现目录说明**：本练习的实际实现位于 `./tdd_sub_directory/` 目录下。
            ```
    *   **核心开发理念链接**：指向通用的开发理念和框架规划文档的相对链接。
        *   **示例格式**:
            ```markdown
            (核心开发理念参考: [测试驱动开发核心理念](./teaching_framework/test_driven_development_with_ai.md))
            (练习框架规划参考: [TDD练习框架设计规划](./teaching_framework/planning_tdd_exercise.md))
            ```
*   **对整个练习系列的简要介绍**：阐述该系列的目的和主要内容。
*   **基础结构说明**：重申或链接到通用的命名规范、目录结构规范。
*   **针对当前练习系列的特定实现概览**：
    *   清晰列出该故事线中包含的所有子练习特性（如 `ExTDD_01_FeatureOne`, `ExTDD_02_FeatureTwo` 等）。
    *   为每个子特性明确其 `feature_name`。
    *   展示每个子特性的预期目录结构（通常是标准化的）。
    *   嵌入此前为每个子特性编写的"核心用户需求"描述。
*   **通用约束或技术依赖（如果适用）**：例如，本系列练习统一使用的工具包、特定环境变量要求等。

## `story_xxx.md` 中最初 *不* 应该包含的细节

再次强调，在 `story_xxx.md` 的初始版本中，尤其是"核心用户需求"部分，应避免过早陷入以下细节：

*   **详尽的特定需求清单**：这些细节将在后续的 `_s2_think_design_{feature_name}.md` 和 `_s3_think_validation_{feature_name}.md` 中具体化。
*   **具体的技术选型或实现细节**：这些是 `_s1_think_options_{feature_name}.md` 和 `_s2_think_design_{feature_name}.md` 阶段的思考内容。
*   **完整的测试用例或精确的验收标准**：这些是 `_s3_think_validation_{feature_name}.md` 的核心内容。

## 总结

`story_xxx.md` 的目标是为TDD流程设定一个清晰、简洁、以用户为中心的起点。通过"先规划系列，再细化特性核心需求"的两步走方法，我们可以为后续更详细的分析、设计和验证阶段留出充分的空间，使其能够自然地在TDD循环中逐层深入、逐步产生。这种方法有助于团队（和AI协作者）首先聚焦于理解用户价值和整体蓝图，然后再逐步深入技术实现细节。 